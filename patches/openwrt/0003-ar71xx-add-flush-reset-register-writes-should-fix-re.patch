From 557eb758f257430b88389b0c767229ac27b38be6 Mon Sep 17 00:00:00 2001
From: Moritz Warning <moritzwarning@web.de>
Date: Thu, 8 Jan 2015 04:03:49 +0100
Subject: [PATCH 3/3] ar71xx: add flush reset register writes, should fix
 restart issues

---
 .../linux/ar71xx/patches-3.10/728-MIPS-ath79-fix-restart.patch | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/target/linux/ar71xx/patches-3.10/728-MIPS-ath79-fix-restart.patch b/target/linux/ar71xx/patches-3.10/728-MIPS-ath79-fix-restart.patch
index 0027c59..b8fc078 100644
--- a/target/linux/ar71xx/patches-3.10/728-MIPS-ath79-fix-restart.patch
+++ b/target/linux/ar71xx/patches-3.10/728-MIPS-ath79-fix-restart.patch
@@ -8,3 +8,13 @@
  	ath79_device_reset_set(AR71XX_RESET_FULL_CHIP);
  	for (;;)
  		if (cpu_wait)
+--- a/arch/mips/include/asm/mach-ath79/ath79.h
++++ b/arch/mips/include/asm/mach-ath79/ath79.h
+@@ -144,6 +144,7 @@ static inline u32 ath79_pll_rr(unsigned 
+ static inline void ath79_reset_wr(unsigned reg, u32 val)
+ {
+ 	__raw_writel(val, ath79_reset_base + reg);
++	(void) __raw_readl(ath79_reset_base + reg); /* flush */
+ }
+ 
+ static inline u32 ath79_reset_rr(unsigned reg)
-- 
2.1.4

